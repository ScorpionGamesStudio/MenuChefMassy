<!doctype html>
<html lang="it">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0b0b0f" />
    <title>Menu della Serata • Casa Edition</title>

    <style>
        :root {
            --bg: #07070a;
            --bg2: #0a0a12;
            --panel: rgba(255,255,255,.06);
            --panel2: rgba(255,255,255,.08);
            --border: rgba(255,255,255,.12);
            --text: rgba(255,255,255,.92);
            --muted: rgba(255,255,255,.66);
            --gold1: #f6d365;
            --gold2: #d6ae54;
            --accent: #caa24a;
            --shadow: 0 24px 80px rgba(0,0,0,.55);
            --radius: 18px;
            --radius2: 26px;
            --max: 1180px;
            --danger: #ff5b6b;
            --ok: #38d6a5;
        }

        body.light {
            --bg: #f7f5f0;
            --bg2: #ffffff;
            --panel: rgba(0,0,0,.04);
            --panel2: rgba(0,0,0,.06);
            --border: rgba(0,0,0,.10);
            --text: rgba(0,0,0,.88);
            --muted: rgba(0,0,0,.62);
            --shadow: 0 20px 60px rgba(0,0,0,.12);
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
        }

        body {
            margin: 0;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
            color: var(--text);
            background: radial-gradient(1200px 600px at 15% -10%, rgba(246,211,101,.20), transparent 60%), radial-gradient(900px 500px at 90% 10%, rgba(202,162,74,.18), transparent 55%), radial-gradient(800px 500px at 50% 110%, rgba(120,90,200,.10), transparent 55%), linear-gradient(180deg, var(--bg) 0%, var(--bg2) 40%, var(--bg) 100%);
            overflow-x: hidden;
        }

            body.modal-open {
                overflow: hidden;
                height: 100%;
            }

        .wrap {
            max-width: var(--max);
            margin: 0 auto;
            padding: 26px 18px 90px;
        }

        /* Top bar */
        .topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 14px;
            padding: 14px 16px;
            border: 1px solid var(--border);
            background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
            border-radius: var(--radius2);
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 10px;
            z-index: 50;
            flex-wrap: wrap;
        }

        body.light .topbar {
            background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.70));
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 42px;
            height: 42px;
            border-radius: 14px;
            background: radial-gradient(14px 14px at 30% 30%, rgba(255,255,255,.35), transparent 60%), linear-gradient(135deg, rgba(246,211,101,.95), rgba(202,162,74,.80));
            box-shadow: 0 12px 30px rgba(202,162,74,.25);
            position: relative;
        }

            .logo:after {
                content: "";
                position: absolute;
                inset: 10px;
                border-radius: 12px;
                border: 1px solid rgba(0,0,0,.22);
                background: rgba(0,0,0,.08);
            }

        .brand h1 {
            font-size: 12px;
            margin: 0;
            letter-spacing: .28em;
            text-transform: uppercase;
            color: rgba(255,255,255,.88);
        }

        body.light .brand h1 {
            color: rgba(0,0,0,.78);
        }

        .brand .sub {
            font-size: 12px;
            margin-top: 2px;
            color: var(--muted);
            letter-spacing: .02em;
        }

        .chef {
            text-align: right;
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 6px 10px;
            border-radius: 14px;
            border: 1px solid rgba(246,211,101,.22);
            background: rgba(202,162,74,.10);
            backdrop-filter: blur(8px);
            margin-left: auto;
            min-width: 220px;
        }

        .chefLabel {
            font-size: 10px;
            letter-spacing: .26em;
            text-transform: uppercase;
            color: rgba(255,255,255,.72);
        }

        .chefName {
            font-size: 12px;
            letter-spacing: .06em;
            color: rgba(255,255,255,.92);
            font-weight: 600;
        }

        body.light .chef {
            background: rgba(0,0,0,.03);
            border-color: rgba(0,0,0,.10);
        }

        body.light .chefLabel {
            color: rgba(0,0,0,.60);
        }

        body.light .chefName {
            color: rgba(0,0,0,.80);
        }

        .actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-end;
            align-items: center;
        }

        .btn {
            border: 1px solid var(--border);
            background: rgba(255,255,255,.05);
            color: rgba(255,255,255,.84);
            padding: 10px 12px;
            border-radius: 999px;
            font-size: 12px;
            cursor: pointer;
            transition: transform .12s ease, background .12s ease, border-color .12s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            user-select: none;
            white-space: nowrap;
        }

        body.light .btn {
            background: rgba(0,0,0,.03);
            color: rgba(0,0,0,.78);
        }

        .btn:hover {
            transform: translateY(-1px);
            background: rgba(255,255,255,.07);
            border-color: rgba(246,211,101,.35);
        }

        body.light .btn:hover {
            background: rgba(0,0,0,.05);
        }

        .btn.danger {
            border-color: rgba(255,91,107,.35);
        }

            .btn.danger:hover {
                border-color: rgba(255,91,107,.55);
            }

        .btn.ok {
            border-color: rgba(56,214,165,.35);
        }

            .btn.ok:hover {
                border-color: rgba(56,214,165,.55);
            }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: linear-gradient(180deg, var(--gold1), var(--gold2));
            box-shadow: 0 0 0 4px rgba(202,162,74,.12);
        }

        .ico {
            width: 16px;
            height: 16px;
            display: inline-block;
            vertical-align: -3px;
        }

        @media (max-width: 720px) {
            .chef {
                order: 3;
                width: 100%;
                text-align: left;
                margin-left: 0;
                min-width: unset;
            }

            .actions {
                order: 4;
                width: 100%;
                justify-content: flex-start;
            }
        }

        /* Cover */
        .cover {
            margin-top: 18px;
            border: 1px solid var(--border);
            background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
            border-radius: var(--radius2);
            box-shadow: var(--shadow);
            overflow: hidden;
            position: relative;
            backdrop-filter: blur(10px);
        }

        body.light .cover {
            background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.76));
        }

        .cover:before {
            content: "";
            position: absolute;
            inset: -2px;
            background: radial-gradient(620px 200px at 18% 0%, rgba(246,211,101,.18), transparent 60%), radial-gradient(620px 200px at 82% 0%, rgba(202,162,74,.14), transparent 60%);
            pointer-events: none;
        }

        .coverInner {
            position: relative;
            padding: 20px;
            display: grid;
            grid-template-columns: 1.2fr .8fr;
            gap: 16px;
            align-items: stretch;
        }

        @media (max-width: 960px) {
            .coverInner {
                grid-template-columns: 1fr;
            }
        }

        .headline {
            margin: 0;
            font-size: clamp(28px, 3.4vw, 46px);
            line-height: 1.06;
            letter-spacing: -0.02em;
        }

            .headline .gold {
                background: linear-gradient(135deg, var(--gold1), var(--gold2));
                -webkit-background-clip: text;
                background-clip: text;
                color: transparent;
                text-shadow: 0 18px 60px rgba(202,162,74,.12);
            }

        .lede {
            margin: 10px 0 0;
            color: var(--muted);
            font-size: 14px;
            line-height: 1.6;
            max-width: 72ch;
        }

        /* SOLO 2 card: Orario + Note */
        .metaGrid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 14px;
        }

        @media (max-width: 520px) {
            .metaGrid {
                grid-template-columns: 1fr;
            }
        }

        .metaCard {
            border: 1px solid rgba(255,255,255,.12);
            background: rgba(255,255,255,.04);
            border-radius: 16px;
            padding: 12px;
        }

        body.light .metaCard {
            border-color: rgba(0,0,0,.10);
            background: rgba(0,0,0,.03);
        }

        .metaCard b {
            display: block;
            font-size: 12px;
            letter-spacing: .18em;
            text-transform: uppercase;
            opacity: .9;
        }

        .metaCard span {
            display: block;
            margin-top: 6px;
            color: var(--muted);
            font-size: 12px;
            line-height: 1.45;
        }

        .toastNote {
            border: 1px solid rgba(246,211,101,.22);
            background: rgba(202,162,74,.10);
            border-radius: 18px;
            padding: 14px;
            height: 100%;
        }

            .toastNote h3 {
                margin: 0;
                font-size: 13px;
                letter-spacing: .22em;
                text-transform: uppercase;
            }

            .toastNote p {
                margin: 10px 0 0;
                color: var(--muted);
                font-size: 13px;
                line-height: 1.6;
            }

            .toastNote .small {
                margin-top: 10px;
                font-size: 12px;
                color: rgba(255,255,255,.72);
            }

        body.light .toastNote .small {
            color: rgba(0,0,0,.70);
        }

        /* Sections */
        .section {
            margin-top: 18px;
            border: 1px solid var(--border);
            background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
            border-radius: var(--radius2);
            overflow: hidden;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            position: relative;
        }

        body.light .section {
            background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.78));
        }

        .sectionHead {
            padding: 16px 18px;
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            gap: 12px;
            border-bottom: 1px solid rgba(255,255,255,.10);
            background: rgba(255,255,255,.03);
        }

        body.light .sectionHead {
            border-bottom-color: rgba(0,0,0,.08);
            background: rgba(0,0,0,.02);
        }

        .sectionHead h2 {
            margin: 0;
            font-size: 13px;
            letter-spacing: .26em;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sectionHead .desc {
            margin: 0;
            color: var(--muted);
            font-size: 12px;
        }

        .sectionActions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .miniBtn {
            width: 34px;
            height: 34px;
            border-radius: 999px;
            border: 1px solid rgba(246,211,101,.22);
            background: rgba(202,162,74,.10);
            color: rgba(255,255,255,.92);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform .12s ease, border-color .12s ease, background .12s ease;
            user-select: none;
            font-size: 18px;
            line-height: 1;
        }

            .miniBtn:hover {
                transform: translateY(-1px);
                border-color: rgba(246,211,101,.35);
                background: rgba(202,162,74,.16);
            }

        body.light .miniBtn {
            background: rgba(0,0,0,.03);
            border-color: rgba(0,0,0,.10);
            color: rgba(0,0,0,.78);
        }

            body.light .miniBtn:hover {
                background: rgba(0,0,0,.05);
                border-color: rgba(0,0,0,.16);
            }

        /* default 3 per riga */
        .grid {
            padding: 16px;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 14px;
        }

        @media (max-width: 980px) {
            .grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        @media (max-width: 560px) {
            .grid {
                grid-template-columns: repeat(1, 1fr);
            }
        }

        .card {
            grid-column: span 4;
            border: 1px solid rgba(255,255,255,.10);
            background: rgba(255,255,255,.04);
            border-radius: var(--radius);
            overflow: hidden;
            transition: transform .12s ease, border-color .12s ease, background .12s ease;
            position: relative;
        }

        body.light .card {
            border-color: rgba(0,0,0,.10);
            background: rgba(0,0,0,.02);
        }

        @media (max-width: 980px) {
            .card {
                grid-column: span 6;
            }
        }

        @media (max-width: 560px) {
            .card {
                grid-column: span 1;
            }
        }

        .card:hover {
            transform: translateY(-2px);
            border-color: rgba(246,211,101,.28);
            background: rgba(255,255,255,.055);
        }

        body.light .card:hover {
            background: rgba(0,0,0,.04);
        }

        .img {
            height: 170px;
            background: #0b0b0f;
            position: relative;
            overflow: hidden;
        }

        body.light .img {
            background: #f0eee9;
        }

        .img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            filter: contrast(1.04) saturate(1.05);
            transform: scale(1.01);
        }

        /* Admin buttons on card */
        .cardBtns {
            position: absolute;
            top: 10px;
            right: 10px;
            display: none;
            gap: 8px;
            z-index: 3;
        }

        body.admin .cardBtns {
            display: flex;
        }

        .editBtn, .delBtn {
            width: 34px;
            height: 34px;
            border-radius: 999px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            transition: transform .12s ease, border-color .12s ease, background .12s ease;
            font-size: 16px;
            line-height: 1;
            color: rgba(255,255,255,.92);
            border: 1px solid rgba(246,211,101,.28);
            background: rgba(202,162,74,.14);
            backdrop-filter: blur(6px);
        }

            .editBtn:hover {
                transform: translateY(-1px);
                border-color: rgba(246,211,101,.45);
                background: rgba(202,162,74,.20);
            }

        .delBtn {
            border: 1px solid rgba(255,91,107,.35);
            background: rgba(255,91,107,.14);
            font-size: 18px;
        }

            .delBtn:hover {
                transform: translateY(-1px);
                border-color: rgba(255,91,107,.55);
                background: rgba(255,91,107,.20);
            }

        body.light .editBtn {
            color: rgba(0,0,0,.85);
            background: rgba(0,0,0,.03);
            border-color: rgba(0,0,0,.10);
        }

        body.light .delBtn {
            color: rgba(0,0,0,.85);
        }

        .content {
            padding: 14px 14px 16px;
        }

        .name {
            margin: 0;
            font-size: 15px;
            letter-spacing: -0.01em;
        }

        .info {
            margin: 8px 0 0;
            color: rgba(255,255,255,.72);
            font-size: 12px;
            line-height: 1.55;
        }

        body.light .info {
            color: rgba(0,0,0,.62);
        }

        /* Center mode (1 o 2 card) */
        .grid.center-few {
            grid-template-columns: repeat(var(--cols, 1), minmax(280px, 360px));
            justify-content: center;
            justify-items: stretch;
        }

            .grid.center-few .card {
                grid-column: auto;
                max-width: 360px;
                width: 100%;
            }

        @media (max-width: 980px) {
            .grid.center-few {
                grid-template-columns: 1fr;
                justify-content: stretch;
            }

                .grid.center-few .card {
                    max-width: none;
                }
        }

        footer {
            margin-top: 16px;
            color: rgba(255,255,255,.55);
            font-size: 12px;
            line-height: 1.5;
            text-align: center;
        }

        body.light footer {
            color: rgba(0,0,0,.55);
        }

        /* Floating save (admin) */
        .saveFloat {
            position: fixed;
            right: 18px;
            bottom: 18px;
            z-index: 200;
            display: none;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        body.admin .saveFloat {
            display: flex;
        }

        .pill {
            border: 1px solid rgba(255,255,255,.12);
            background: rgba(0,0,0,.26);
            backdrop-filter: blur(10px);
            color: rgba(255,255,255,.82);
            border-radius: 999px;
            padding: 10px 12px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body.light .pill {
            background: rgba(255,255,255,.8);
            color: rgba(0,0,0,.75);
            border-color: rgba(0,0,0,.10);
        }

        /* Modal */
        .modalBack {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,.62);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 16px;
            z-index: 999;
        }

            .modalBack.show {
                display: flex;
            }

        .modal {
            width: min(860px, 100%);
            border: 1px solid rgba(255,255,255,.14);
            background: linear-gradient(180deg, rgba(20,20,30,.88), rgba(10,10,16,.88));
            border-radius: 22px;
            box-shadow: 0 40px 120px rgba(0,0,0,.65);
            overflow: hidden;
            backdrop-filter: blur(10px);
            max-height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        body.light .modal {
            background: rgba(255,255,255,.95);
            border-color: rgba(0,0,0,.12);
        }

        .modalHead {
            padding: 14px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid rgba(255,255,255,.10);
            background: rgba(255,255,255,.03);
            flex: 0 0 auto;
        }

        body.light .modalHead {
            border-bottom-color: rgba(0,0,0,.08);
            background: rgba(0,0,0,.02);
        }

        .modalHead h3 {
            margin: 0;
            font-size: 13px;
            letter-spacing: .22em;
            text-transform: uppercase;
        }

        .modalBody {
            padding: 16px;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1 1 auto;
            max-height: calc(100vh - 40px - 60px);
        }

        /* form */
        .panel {
            border: 1px solid rgba(255,255,255,.10);
            background: rgba(255,255,255,.04);
            border-radius: 18px;
            padding: 14px;
        }

        body.light .panel {
            border-color: rgba(0,0,0,.10);
            background: rgba(0,0,0,.02);
        }

        .row {
            display: grid;
            grid-template-columns: 180px 1fr;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }

        @media (max-width: 720px) {
            .row {
                grid-template-columns: 1fr;
            }
        }

        label {
            font-size: 12px;
            letter-spacing: .18em;
            text-transform: uppercase;
            color: rgba(255,255,255,.80);
        }

        body.light label {
            color: rgba(0,0,0,.70);
        }

        input[type="text"], input[type="password"], textarea {
            width: 100%;
            padding: 10px 12px;
            border-radius: 14px;
            border: 1px solid rgba(255,255,255,.12);
            background: rgba(0,0,0,.18);
            color: var(--text);
            outline: none;
        }

        body.light input[type="text"], body.light input[type="password"], body.light textarea {
            background: rgba(255,255,255,.75);
            color: rgba(0,0,0,.85);
            border-color: rgba(0,0,0,.10);
        }

        textarea {
            min-height: 90px;
            resize: vertical;
        }

        .mini {
            font-size: 12px;
            color: var(--muted);
            line-height: 1.5;
            margin-top: 10px;
        }

        .right {
            text-align: right;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .fileRow {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .fileActions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .thumb {
            width: 100%;
            height: 160px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,.12);
            background: rgba(0,0,0,.16);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

            .thumb img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                display: block;
            }

        body.light .thumb {
            background: rgba(0,0,0,.02);
            border-color: rgba(0,0,0,.10);
        }

        @media print {
            .topbar, .actions, .saveFloat {
                display: none !important;
            }

            body {
                background: white !important;
            }

            .wrap {
                padding: 0;
            }

            .section, .cover {
                box-shadow: none !important;
            }

            .chef {
                display: none !important;
            }

            .modalBack {
                display: none !important;
            }

            .cardBtns {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <header class="topbar">
            <div class="brand">
                <div class="logo" aria-hidden="true"></div>
                <div>
                    <h1>Menu della Serata</h1>
                    <div class="sub">
                        <span id="dateText">—</span> • <span style="letter-spacing:.08em;">Casa Edition</span>
                    </div>
                </div>
            </div>

            <div class="chef" aria-label="Chef">
                <span class="chefLabel">Chef della serata</span>
                <span class="chefName" id="chefNameTop">Massimiliano Giannone</span>
            </div>

            <div class="actions">
                <button class="btn" id="toggleTheme" type="button" title="Modalità chiara/scura">
                    <span class="dot" aria-hidden="true"></span>
                    Modalità
                </button>

                <button class="btn" id="printBtn" type="button" title="Stampa o salva in PDF">
                    <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M7 8V4h10v4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                        <path d="M7 17h10v3H7v-3Z" stroke="currentColor" stroke-width="1.8" />
                        <path d="M6 10h12a2 2 0 0 1 2 2v3h-3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                        <path d="M7 15H4v-3a2 2 0 0 1 2-2" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                    </svg>
                    PDF / Stampa
                </button>

                <button class="btn" id="editEventBtn" type="button" title="Modifica evento (solo admin)" style="display:none;">
                    ✏️ Modifica evento
                </button>

                <button class="btn" id="adminBtn" type="button" title="Apri modalità admin">
                    <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M12 3l7 4v6c0 5-3 8-7 8s-7-3-7-8V7l7-4Z" stroke="currentColor" stroke-width="1.8" />
                        <path d="M12 10v4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                        <path d="M12 16h.01" stroke="currentColor" stroke-width="2.6" stroke-linecap="round" />
                    </svg>
                    Admin
                </button>

                <button class="btn danger" id="logoutBtn" type="button" title="Logout (solo admin)" style="display:none;">
                    Logout
                </button>
            </div>
        </header>

        <section class="cover" aria-label="Copertina evento">
            <div class="coverInner">
                <div>
                    <h2 class="headline">
                        <span id="heroPrefix">Stasera a casa:</span>
                        <span class="gold" id="heroGold">cena da 3 stelle</span>
                    </h2>
                    <p class="lede" id="heroDesc">
                        Un menu completo, elegante e moderno. Presentato in modo “wow” come fosse un fine-dining,
                        ma con il calore di una serata tra amici e famiglia.
                    </p>

                    <div class="metaGrid" aria-label="Dettagli serata">
                        <div class="metaCard">
                            <b>Orario</b>
                            <span id="metaOrario">20:30 • Aperitivo & Antipasti<br />21:15 • Portate principali</span>
                        </div>
                        <div class="metaCard">
                            <b>Note</b>
                            <span id="metaNote">Chiedimi per allergeni o alternative.<br />Piatti serviti “a ondate”.</span>
                        </div>
                    </div>
                </div>

                <aside class="toastNote" aria-label="Toast di benvenuto">
                    <h3>Benvenuto</h3>
                    <p id="toastText">
                        “Questa sera ci prendiamo un momento per stare insieme, mangiare bene e fare due risate.
                        Io cucino, voi godetevela.”
                    </p>
                    <p class="small"><b>Tip scenico:</b> apri questa pagina dal QR e fai scorrere il menu mentre servi le portate.</p>
                </aside>
            </div>
        </section>

        <div id="menuRoot"></div>

        <footer>
            Tip velocissimo: usa foto reali dei tuoi piatti (anche scattate col telefono). Con l’admin puoi fare tutto in 2 minuti.
        </footer>
    </div>

    <div class="saveFloat" id="saveFloat">
        <div class="pill" id="dirtyPill" style="display:none;">
            <span class="dot" aria-hidden="true"></span>
            Modifiche non salvate
        </div>

        <!-- opzionale: esporta manuale -->
        <button class="btn" id="exportBtn" type="button" title="Scarica menu-data.json">Esporta JSON</button>

        <!-- il bottone principale -->
        <button class="btn ok" id="saveAllBtn" type="button" title="Salva + scarica menu-data.json">Salva</button>
    </div>

    <div class="modalBack" id="modalBack" aria-hidden="true">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
            <div class="modalHead">
                <h3 id="modalTitle">—</h3>
                <button class="btn danger" id="modalClose" type="button">Chiudi</button>
            </div>
            <div class="modalBody" id="modalBody"></div>
        </div>
    </div>

    <script>
    /******************************************************************
     * CONFIG
     ******************************************************************/
    const ADMIN_USERNAME = "admin"; // cambia qui
    const ADMIN_PASSWORD = "1234";  // cambia qui

    // ✅ Questo file DEVE essere nella stessa cartella di index.html su GitHub
    const REMOTE_DATA_FILE = "menu-data.json";

    const SESSION_KEY = "menu_admin_session_v6";
    const MENU_KEY = "menu_data_v6_localcache";

    let MENU = null;
    let DRAFT = null;
    let DIRTY = false;

    function $(id){ return document.getElementById(id); }

    function escapeXml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#39;");
    }
    function safeParseJson(txt){ try{ return JSON.parse(txt); }catch{ return null; } }
    function deepClone(obj){ return JSON.parse(JSON.stringify(obj)); }

    function setDirty(v){
      DIRTY = v;
      $("dirtyPill").style.display = DIRTY ? "flex" : "none";
    }

    function stopWheelChaining(e){
      const el = $("modalBody");
      const delta = e.deltaY;
      const atTop = el.scrollTop <= 0;
      const atBottom = el.scrollTop + el.clientHeight >= el.scrollHeight - 1;
      if ((delta < 0 && atTop) || (delta > 0 && atBottom)) e.preventDefault();
    }

    function openModal(title, html){
      $("modalTitle").textContent = title;
      $("modalBody").innerHTML = html;

      $("modalBack").classList.add("show");
      $("modalBack").setAttribute("aria-hidden","false");
      document.body.classList.add("modal-open");

      $("modalBody").scrollTop = 0;
      $("modalBody").addEventListener("wheel", stopWheelChaining, { passive: false });
    }

    function closeModal(){
      $("modalBack").classList.remove("show");
      $("modalBack").setAttribute("aria-hidden","true");
      document.body.classList.remove("modal-open");
      $("modalBody").removeEventListener("wheel", stopWheelChaining);
      $("modalBody").innerHTML = "";
    }

    function nlToBr(s){
      return String(s ?? "").split("\n").map(x=>x.trimEnd()).join("<br/>");
    }
    function brToNl(s){
      return String(s ?? "").replaceAll("<br/>","\n").replaceAll("<br>","\n");
    }

    function placeholderSvg(title){
      return `data:image/svg+xml;utf8,
      <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800">
        <defs>
          <linearGradient id="g" x1="0" x2="1">
            <stop offset="0" stop-color="%2307070a"/>
            <stop offset="1" stop-color="%23151622"/>
          </linearGradient>
          <radialGradient id="r" cx="25%" cy="20%" r="70%">
            <stop offset="0" stop-color="%23f6d365" stop-opacity="0.20"/>
            <stop offset="1" stop-color="%23d6ae54" stop-opacity="0"/>
          </radialGradient>
        </defs>
        <rect width="100%" height="100%" fill="url(%23g)"/>
        <circle cx="320" cy="170" r="420" fill="url(%23r)"/>
        <rect x="120" y="210" width="960" height="460" rx="48" fill="%23ffffff" fill-opacity="0.06" stroke="%23ffffff" stroke-opacity="0.12"/>
        <text x="160" y="350" font-size="54" fill="%23ffffff" fill-opacity="0.92" font-family="Arial">${escapeXml(title || "Piatto")}</text>
        <text x="160" y="420" font-size="28" fill="%23ffffff" fill-opacity="0.62" font-family="Arial">foto in arrivo ✨</text>
      </svg>`;
    }

    function fileToDataUrl(file){
      return new Promise((resolve, reject)=>{
        const reader = new FileReader();
        reader.onload = () => resolve(String(reader.result || ""));
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    async function downscaleDataUrl(dataUrl, maxSide=1400, quality=0.86){
      if(!dataUrl.startsWith("data:image/")) return dataUrl;
      return new Promise((resolve)=>{
        const img = new Image();
        img.onload = ()=>{
          const w = img.width, h = img.height;
          const scale = Math.min(1, maxSide / Math.max(w,h));
          if(scale >= 1){ resolve(dataUrl); return; }
          const canvas = document.createElement("canvas");
          canvas.width = Math.round(w * scale);
          canvas.height = Math.round(h * scale);
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          const out = canvas.toDataURL("image/jpeg", quality);
          resolve(out);
        };
        img.onerror = ()=> resolve(dataUrl);
        img.src = dataUrl;
      });
    }

    /******************************************************************
     * DEFAULT DATA
     ******************************************************************/
    const DEFAULT_DATA = {
      cover: {
        browserTitle: "Menu della Serata • Casa Edition",
        heroPrefix: "Stasera a casa:",
        heroGold: "cena da 3 stelle",
        heroDesc: "Un menu completo, elegante e moderno. Presentato in modo “wow” come fosse un fine-dining, ma con il calore di una serata tra amici e famiglia.",
        chefName: "Massimiliano Giannone",
        toast: "“Questa sera ci prendiamo un momento per stare insieme, mangiare bene e fare due risate. Io cucino, voi godetevela.”",
        metaOrario: "20:30 • Aperitivo & Antipasti<br/>21:15 • Portate principali",
        metaNote: "Chiedimi per allergeni o alternative.<br/>Piatti serviti “a ondate”."
      },
      sections: [
        { key:"antipasti", title:"Antipasti", desc:"Il benvenuto (piccoli assaggi, grande impatto)" },
        { key:"primi", title:"Primi", desc:"La portata che fa innamorare" },
        { key:"secondi", title:"Secondi", desc:"Il piatto protagonista" },
        { key:"dolci", title:"Dolci", desc:"Finale morbido, felice, memorabile" },
        { key:"bevande", title:"Bevande", desc:"Durante la serata (scegli, abbina, brinda)" }
      ],
      itemsBySection: {
        antipasti: [
          { name:"Bruschette gourmet", info:"Croccanti, profumate, con topping ricchi e servite “a degustazione”.", imageUrl:"" },
          { name:"Spritz", info:"Leggero e frizzante, perfetto per aprire la serata con stile.", imageUrl:"" }
        ],
        primi: [
          { name:"Pasta con gamberi e stracciatella", info:"Gamberi cotti con vino bianco, bisk di gambero, stracciatella e gambero rosso crudo: cremoso, saporito e fresco.", imageUrl:"" }
        ],
        secondi: [
          { name:"Pesce spada in crosta di pistacchio", info:"Rosolato con vino bianco e brodo di pesce chiarificato, servito con fondo e crosta di pistacchio: delicato e sorprendente.", imageUrl:"" }
        ],
        dolci: [
          { name:"Cannolo siciliano", info:"Cremoso e croccante: un classico che chiude la serata con il sapore della nostra terra.", imageUrl:"" }
        ],
        bevande: [
          { name:"Acqua liscia & frizzante", info:"Sempre in tavola, servita fresca.", imageUrl:"" },
          { name:"[Inserisci qui i vini della serata]", info:"Esempio: Bianco fresco per antipasti / Rosso morbido per i secondi / Bollicine per brindare.", imageUrl:"" },
          { name:"Analcolici", info:"Tonica, cola, succhi: perfetti anche per chi non beve alcol.", imageUrl:"" },
          { name:"Birre", info:"Normale, alla spina e bionda: scegli la tua e brindiamo 🍻", imageUrl:"" }
        ]
      }
    };

    /******************************************************************
     * STORAGE + REMOTE LOADING
     ******************************************************************/
    function saveMenuToLocal(data){
      localStorage.setItem(MENU_KEY, JSON.stringify(data));
    }

    function loadMenuFromLocal(){
      const raw = localStorage.getItem(MENU_KEY);
      if(!raw){
        saveMenuToLocal(deepClone(DEFAULT_DATA));
      }
      const parsed = safeParseJson(localStorage.getItem(MENU_KEY));
      if(!parsed){
        saveMenuToLocal(deepClone(DEFAULT_DATA));
        return deepClone(DEFAULT_DATA);
      }
      // normalize minimal
      parsed.cover = parsed.cover || {};
      if(!parsed.cover.browserTitle) parsed.cover.browserTitle = DEFAULT_DATA.cover.browserTitle;
      if(!parsed.cover.chefName) parsed.cover.chefName = DEFAULT_DATA.cover.chefName;
      if(!parsed.cover.metaOrario) parsed.cover.metaOrario = DEFAULT_DATA.cover.metaOrario;
      if(!parsed.cover.metaNote) parsed.cover.metaNote = DEFAULT_DATA.cover.metaNote;
      return parsed;
    }

    async function loadMenuAsync(){
      // 1) prova a caricare il JSON pubblico (vale per tutti i dispositivi)
      try{
        const res = await fetch(REMOTE_DATA_FILE, { cache: "no-store" });
        if(res.ok){
          const txt = await res.text();
          const data = JSON.parse(txt);
          saveMenuToLocal(data); // cache locale
          return data;
        }
      }catch(e){
        // ignore -> fallback
      }
      // 2) fallback locale
      return loadMenuFromLocal();
    }

    /******************************************************************
     * SESSION
     ******************************************************************/
    function isAdmin(){ return localStorage.getItem(SESSION_KEY) === "1"; }
    function logout(){ localStorage.removeItem(SESSION_KEY); }

    /******************************************************************
     * RENDER
     ******************************************************************/
    function renderPublic(menu, adminMode){
      document.title = menu.cover.browserTitle || DEFAULT_DATA.cover.browserTitle;

      $("chefNameTop").textContent = menu.cover.chefName || DEFAULT_DATA.cover.chefName;
      $("heroPrefix").textContent = menu.cover.heroPrefix || "";
      $("heroGold").textContent = menu.cover.heroGold || "";
      $("heroDesc").textContent = menu.cover.heroDesc || "";
      $("toastText").textContent = menu.cover.toast || "";

      $("metaOrario").innerHTML = menu.cover.metaOrario || "";
      $("metaNote").innerHTML = menu.cover.metaNote || "";

      $("editEventBtn").style.display = adminMode ? "inline-flex" : "none";

      const root = $("menuRoot");
      root.innerHTML = "";

      for(const section of menu.sections){
        const items = (menu.itemsBySection && menu.itemsBySection[section.key]) ? menu.itemsBySection[section.key] : [];
        const sectionEl = document.createElement("section");
        sectionEl.className = "section";
        sectionEl.setAttribute("aria-label", section.title);

        const actionsHtml = adminMode ? `
          <div class="sectionActions">
            <button class="miniBtn" title="Aggiungi" data-add="${escapeXml(section.key)}">+</button>
          </div>
        ` : `<div></div>`;

        sectionEl.innerHTML = `
          <div class="sectionHead">
            <h2><span class="dot" aria-hidden="true"></span> ${escapeXml(section.title)}</h2>
            <div style="display:flex; align-items:baseline; gap:12px;">
              <p class="desc">${escapeXml(section.desc || "")}</p>
              ${actionsHtml}
            </div>
          </div>
          <div class="grid" data-section="${escapeXml(section.key)}"></div>
        `;

        const grid = sectionEl.querySelector(".grid");

        items.forEach((it, idx) => {
          const img = (it.imageUrl && String(it.imageUrl).trim())
            ? String(it.imageUrl).trim()
            : placeholderSvg(it.name || "Piatto");

          const card = document.createElement("article");
          card.className = "card";
          card.setAttribute("data-idx", String(idx));
          card.setAttribute("data-sec", section.key);

          card.innerHTML = `
            <div class="img">
              ${adminMode ? `
                <div class="cardBtns">
                  <button class="editBtn" title="Modifica" data-edit="${escapeXml(section.key)}:${idx}">✏️</button>
                  <button class="delBtn" title="Elimina" data-del="${escapeXml(section.key)}:${idx}">−</button>
                </div>
              ` : ``}
              <img alt="${escapeXml(it.name || "Piatto")}" src="${img}">
            </div>
            <div class="content">
              <h3 class="name">${escapeXml(it.name || "")}</h3>
              <p class="info">${escapeXml(it.info || "")}</p>
            </div>
          `;
          grid.appendChild(card);
        });

        root.appendChild(sectionEl);
      }

      // center sections with 1 or 2 items
      document.querySelectorAll('.section .grid').forEach(grid => {
        const count = grid.querySelectorAll('.card').length;
        if (count > 0 && count < 3) {
          grid.classList.add('center-few');
          grid.style.setProperty('--cols', String(count));
        } else {
          grid.classList.remove('center-few');
          grid.style.removeProperty('--cols');
        }
      });

      if(adminMode){
        document.querySelectorAll("[data-add]").forEach(btn=>{
          btn.addEventListener("click", (e)=>{
            e.stopPropagation();
            const key = btn.getAttribute("data-add");
            openCreateModal(key);
          });
        });

        document.querySelectorAll("[data-del]").forEach(btn=>{
          btn.addEventListener("click", (e)=>{
            e.stopPropagation();
            const v = btn.getAttribute("data-del");
            const [sec, idxStr] = v.split(":");
            deleteItem(sec, Number(idxStr));
          });
        });

        document.querySelectorAll("[data-edit]").forEach(btn=>{
          btn.addEventListener("click", (e)=>{
            e.stopPropagation();
            const v = btn.getAttribute("data-edit");
            const [sec, idxStr] = v.split(":");
            openEditModal(sec, Number(idxStr));
          });
        });
      }
    }

    function ensureDraft(){
      if(!DRAFT) DRAFT = deepClone(MENU);
      if(!DRAFT.itemsBySection) DRAFT.itemsBySection = {};
      if(!DRAFT.cover) DRAFT.cover = deepClone(DEFAULT_DATA.cover);
    }

    function openCreateModal(sectionKey){
      ensureDraft();
      const empty = { name:"", info:"", imageUrl:"" };
      openItemModal("Aggiungi piatto", empty, (savedItem)=>{
        const list = DRAFT.itemsBySection[sectionKey] || (DRAFT.itemsBySection[sectionKey] = []);
        list.push(savedItem);
        setDirty(true);
        renderPublic(DRAFT, true);
      });
    }

    function openEditModal(sectionKey, idx){
      ensureDraft();
      const list = DRAFT.itemsBySection[sectionKey] || [];
      const it = list[idx];
      if(!it) return;
      openItemModal("Modifica piatto", deepClone(it), (savedItem)=>{
        list[idx] = savedItem;
        setDirty(true);
        renderPublic(DRAFT, true);
      }, true);
    }

    function deleteItem(sectionKey, idx){
      ensureDraft();
      const list = DRAFT.itemsBySection[sectionKey] || [];
      const it = list[idx];
      if(!it) return;

      openModal("Elimina", `
        <div class="panel">
          <b style="letter-spacing:.18em; text-transform:uppercase; font-size:12px;">Conferma</b>
          <p class="mini">Vuoi eliminare: <b>${escapeXml(it.name || "(senza nome)")}</b>?</p>
          <div class="right">
            <button class="btn" id="cancelDel" type="button">Annulla</button>
            <button class="btn danger" id="doDel" type="button">Elimina</button>
          </div>
        </div>
      `);

      setTimeout(()=>{
        const c = document.getElementById("cancelDel");
        const d = document.getElementById("doDel");
        if(c) c.onclick = closeModal;
        if(d) d.onclick = ()=>{
          list.splice(idx, 1);
          setDirty(true);
          renderPublic(DRAFT, true);
          closeModal();
        };
      },0);
    }

    function openItemModal(title, item, onSave, allowEmptyName=false){
      const currentImg = (item.imageUrl && String(item.imageUrl).trim()) ? String(item.imageUrl).trim() : "";
      const preview = currentImg ? currentImg : placeholderSvg(item.name || "Piatto");

      openModal(title, `
        <div class="panel">
          <div class="row">
            <label>Titolo</label>
            <input id="fName" type="text" value="${escapeXml(item.name || "")}" placeholder="Es: Bruschette gourmet" />
          </div>

          <div class="row">
            <label>Descrizione</label>
            <textarea id="fInfo" placeholder="Descrizione breve...">${escapeXml(item.info || "")}</textarea>
          </div>

          <div class="row">
            <label>Immagine</label>
            <div class="fileRow">
              <div class="thumb"><img id="imgPreview" alt="preview" src="${preview}"></div>

              <div class="fileActions">
                <input id="fFile" type="file" accept="image/*" style="display:none" />
                <button class="btn" id="pickFile" type="button">📷 Carica dal PC</button>

                <button class="btn danger" id="clearImg" type="button">Rimuovi</button>
              </div>

              <div class="mini">Oppure incolla un URL (opzionale):</div>
              <input id="fImgUrl" type="text" value="${escapeXml(currentImg && currentImg.startsWith("http") ? currentImg : "")}" placeholder="https://..." />
              <div class="mini">
                Nota: se carichi dal PC, l’immagine viene salvata nel JSON (base64). Tienile leggere.
              </div>
            </div>
          </div>

          <div class="right">
            <button class="btn" id="cancelItem" type="button">Annulla</button>
            <button class="btn ok" id="saveItem" type="button">Conferma</button>
          </div>
        </div>
      `);

      setTimeout(()=>{
        const cancel = document.getElementById("cancelItem");
        const save = document.getElementById("saveItem");
        const nameEl = document.getElementById("fName");

        const pickFileBtn = document.getElementById("pickFile");
        const fileInput = document.getElementById("fFile");
        const clearBtn = document.getElementById("clearImg");
        const previewImg = document.getElementById("imgPreview");
        const urlInput = document.getElementById("fImgUrl");

        let modalImage = currentImg;

        if(cancel) cancel.onclick = closeModal;

        if(pickFileBtn && fileInput){
          pickFileBtn.onclick = ()=> fileInput.click();
          fileInput.onchange = async ()=>{
            const file = fileInput.files && fileInput.files[0];
            if(!file) return;
            try{
              let dataUrl = await fileToDataUrl(file);
              dataUrl = await downscaleDataUrl(dataUrl, 1400, 0.86);
              modalImage = dataUrl;
              previewImg.src = dataUrl;
              urlInput.value = "";
            }catch(e){
              console.error(e);
              openModal("Errore immagine", `
                <div class="panel">
                  <b style="letter-spacing:.18em; text-transform:uppercase; font-size:12px;">Impossibile caricare</b>
                  <p class="mini">Riprova con un file più leggero.</p>
                  <div class="right">
                    <button class="btn ok" id="imgErrClose" type="button">Ok</button>
                  </div>
                </div>
              `);
              setTimeout(()=>{
                const b = document.getElementById("imgErrClose");
                if(b) b.onclick = closeModal;
              },0);
            }
          };
        }

        if(clearBtn){
          clearBtn.onclick = ()=>{
            modalImage = "";
            previewImg.src = placeholderSvg(nameEl.value || "Piatto");
            urlInput.value = "";
            if(fileInput) fileInput.value = "";
          };
        }

        if(urlInput){
          urlInput.addEventListener("input", ()=>{
            const v = urlInput.value.trim();
            if(v){
              modalImage = v;
              previewImg.src = v;
            }else{
              if(!modalImage || modalImage.startsWith("http")){
                modalImage = "";
                previewImg.src = placeholderSvg(nameEl.value || "Piatto");
              }
            }
          });
        }

        if(nameEl){
          nameEl.addEventListener("input", ()=>{
            if(!modalImage){
              previewImg.src = placeholderSvg(nameEl.value || "Piatto");
            }
          });
        }

        if(save) save.onclick = ()=>{
          const name = document.getElementById("fName").value.trim();
          const info = document.getElementById("fInfo").value.trim();
          const url = (document.getElementById("fImgUrl").value || "").trim();

          let finalImg = modalImage;
          if(!finalImg && url) finalImg = url;

          if(!allowEmptyName && !name){
            nameEl.focus();
            nameEl.style.borderColor = "rgba(255,91,107,.75)";
            return;
          }

          onSave({
            name: name || "(senza nome)",
            info: info || "",
            imageUrl: finalImg || ""
          });

          closeModal();
        };
      },0);
    }

    function openEventModal(){
      ensureDraft();
      const c = DRAFT.cover;

      openModal("Modifica evento", `
        <div class="panel">
          <div class="row">
            <label>Titolo browser</label>
            <input id="eBrowserTitle" type="text" value="${escapeXml(c.browserTitle || "")}" placeholder="Es: Cena a Casa • 05 Gennaio" />
          </div>

          <div class="row">
            <label>Titolo (prima parte)</label>
            <input id="eHeroPrefix" type="text" value="${escapeXml(c.heroPrefix || "")}" placeholder="Es: Stasera a casa:" />
          </div>

          <div class="row">
            <label>Titolo (parte oro)</label>
            <input id="eHeroGold" type="text" value="${escapeXml(c.heroGold || "")}" placeholder="Es: cena da 3 stelle" />
          </div>

          <div class="row">
            <label>Descrizione evento</label>
            <textarea id="eHeroDesc" placeholder="Testo sotto il titolo...">${escapeXml(c.heroDesc || "")}</textarea>
          </div>

          <div class="row">
            <label>Benvenuto</label>
            <textarea id="eToast" placeholder="Testo del benvenuto...">${escapeXml(c.toast || "")}</textarea>
          </div>

          <div class="row">
            <label>Orario</label>
            <textarea id="eOrario" placeholder="Usa invio per andare a capo...">${escapeXml(brToNl(c.metaOrario || ""))}</textarea>
          </div>

          <div class="row">
            <label>Note</label>
            <textarea id="eNote" placeholder="Usa invio per andare a capo...">${escapeXml(brToNl(c.metaNote || ""))}</textarea>
          </div>

          <p class="mini">
            Suggerimento: per Orario/Note puoi andare a capo: verrà trasformato in <b>&lt;br/&gt;</b>.
          </p>

          <div class="right">
            <button class="btn" id="cancelEvent" type="button">Annulla</button>
            <button class="btn ok" id="saveEvent" type="button">Conferma</button>
          </div>
        </div>
      `);

      setTimeout(()=>{
        const cancel = document.getElementById("cancelEvent");
        const save = document.getElementById("saveEvent");
        if(cancel) cancel.onclick = closeModal;

        if(save) save.onclick = ()=>{
          const browserTitle = document.getElementById("eBrowserTitle").value.trim();
          const heroPrefix = document.getElementById("eHeroPrefix").value.trim();
          const heroGold = document.getElementById("eHeroGold").value.trim();
          const heroDesc = document.getElementById("eHeroDesc").value.trim();
          const toast = document.getElementById("eToast").value.trim();

          const orario = document.getElementById("eOrario").value;
          const note = document.getElementById("eNote").value;

          DRAFT.cover.browserTitle = browserTitle || DEFAULT_DATA.cover.browserTitle;
          DRAFT.cover.heroPrefix = heroPrefix || "";
          DRAFT.cover.heroGold = heroGold || "";
          DRAFT.cover.heroDesc = heroDesc || "";
          DRAFT.cover.toast = toast || "";

          DRAFT.cover.metaOrario = nlToBr(orario);
          DRAFT.cover.metaNote = nlToBr(note);

          setDirty(true);
          renderPublic(DRAFT, true);
          closeModal();
        };
      },0);
    }

    function showLogin(){
      openModal("Login Admin", `
        <div class="panel">
          <div class="row">
            <label>Username</label>
            <input id="loginUser" type="text" placeholder="username" autocomplete="username" />
          </div>
          <div class="row">
            <label>Password</label>
            <input id="loginPass" type="password" placeholder="password" autocomplete="current-password" />
          </div>
          <div class="right">
            <button class="btn ok" id="doLogin" type="button">Accedi</button>
          </div>
          <p class="mini">
            Cambia le credenziali nel codice: <b>ADMIN_USERNAME</b> e <b>ADMIN_PASSWORD</b>.
          </p>
        </div>
      `);

      setTimeout(()=>{
        const btn = document.getElementById("doLogin");
        const u = document.getElementById("loginUser");
        const p = document.getElementById("loginPass");

        function attempt(){
          const uu = (u.value || "").trim();
          const pp = (p.value || "").trim();
          if(uu === ADMIN_USERNAME && pp === ADMIN_PASSWORD){
            localStorage.setItem(SESSION_KEY, "1");
            closeModal();
            enterAdmin();
          }else{
            openModal("Login Admin", `
              <div class="panel">
                <b style="letter-spacing:.18em; text-transform:uppercase; font-size:12px;">Credenziali errate</b>
                <p class="mini">Riprova.</p>
                <div class="right">
                  <button class="btn" id="retryLogin" type="button">Riprova</button>
                </div>
              </div>
            `);
            setTimeout(()=>{
              const r = document.getElementById("retryLogin");
              if(r) r.onclick = showLogin;
            },0);
          }
        }

        if(btn) btn.onclick = attempt;
        if(p){
          p.addEventListener("keydown", (e)=>{
            if(e.key === "Enter") attempt();
          });
        }
      },0);
    }

    function enterAdmin(){
      document.body.classList.add("admin");
      $("logoutBtn").style.display = "inline-flex";
      $("saveFloat").style.display = "flex";
      $("editEventBtn").style.display = "inline-flex";

      // usa quello che è già caricato in MENU e crea una bozza
      DRAFT = deepClone(MENU || loadMenuFromLocal());
      setDirty(false);
      renderPublic(DRAFT, true);
    }

    function exitAdmin(){
      document.body.classList.remove("admin");
      $("logoutBtn").style.display = "none";
      $("saveFloat").style.display = "none";
      $("editEventBtn").style.display = "none";
      setDirty(false);
      DRAFT = null;
      renderPublic(MENU, false);
    }

    function route(){
      const adminRoute = (location.hash || "").toLowerCase() === "#admin";
      if(!adminRoute){
        if(isAdmin()) exitAdmin();
        else {
          document.body.classList.remove("admin");
          $("logoutBtn").style.display = "none";
          $("saveFloat").style.display = "none";
          $("editEventBtn").style.display = "none";
          renderPublic(MENU, false);
        }
        return;
      }

      if(isAdmin()){
        enterAdmin();
      }else{
        renderPublic(MENU, false);
        showLogin();
      }
    }

    /******************************************************************
     * EXPORT JSON (download)
     * Nota: non può salvare sul desktop automaticamente né sovrascrivere file.
     ******************************************************************/
    function downloadJsonFile(data, filename="menu-data.json"){
      const dataStr = JSON.stringify(data, null, 2);
      const blob = new Blob([dataStr], { type: "application/json" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.download = filename;
      a.href = url;
      document.body.appendChild(a);
      a.click();
      a.remove();

      setTimeout(()=> URL.revokeObjectURL(url), 500);
    }

    function exportJson(){
      if(!isAdmin() || !DRAFT) return;
      downloadJsonFile(DRAFT, "menu-data.json");
    }

    function saveAll(){
      if(!isAdmin() || !DRAFT) return;

      // 1) salva cache locale (utile mentre lavori)
      saveMenuToLocal(DRAFT);
      MENU = deepClone(DRAFT);
      setDirty(false);

      // 2) ✅ genera automaticamente il file menu-data.json (download)
      // (questo è il modo più vicino possibile al tuo “salva sul desktop”)
      downloadJsonFile(DRAFT, "menu-data.json");

      openModal("Salvato", `
        <div class="panel">
          <b style="letter-spacing:.18em; text-transform:uppercase; font-size:12px;">Ok ✅</b>
          <p class="mini">
            Ho salvato e scaricato <b>menu-data.json</b>.<br/>
            Caricalo su GitHub (root della repo) per far vedere gli stessi dati a tutti (PC/telefono/QR).
          </p>
          <div class="right">
            <button class="btn ok" id="okClose" type="button">Ok</button>
          </div>
        </div>
      `);
      setTimeout(()=>{
        const b = document.getElementById("okClose");
        if(b) b.onclick = closeModal;
      },0);

      renderPublic(DRAFT, true);
    }

    (async function init(){
      const d = new Date();
      const fmt = new Intl.DateTimeFormat('it-IT', { weekday:'long', day:'2-digit', month:'long', year:'numeric' });
      $("dateText").textContent = fmt.format(d);

      $("toggleTheme").addEventListener("click", ()=> document.body.classList.toggle("light"));
      $("printBtn").addEventListener("click", ()=> window.print());

      $("modalClose").addEventListener("click", closeModal);

      // Non chiudere cliccando sullo sfondo (evita perdere modifiche)
      $("modalBack").addEventListener("click", (e)=>{});

      $("adminBtn").addEventListener("click", ()=>{
        location.hash = "#admin";
        route();
      });

      $("logoutBtn").addEventListener("click", ()=>{
        logout();
        location.hash = "";
        exitAdmin();
      });

      $("saveAllBtn").addEventListener("click", saveAll);
      $("exportBtn").addEventListener("click", exportJson);

      $("editEventBtn").addEventListener("click", ()=>{
        if(!isAdmin()) return;
        openEventModal();
      });

      // ✅ Qui carico PRIMA il file menu-data.json dal sito.
      // Se non esiste ancora (prima volta), fallback al local.
      MENU = await loadMenuAsync();
      renderPublic(MENU, false);

      window.addEventListener("hashchange", route);
      route();

      window.addEventListener("beforeunload", (e)=>{
        if(isAdmin() && DIRTY){
          e.preventDefault();
          e.returnValue = "";
        }
      });
    })();
    </script>
</body>
</html>